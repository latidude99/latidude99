{% extends "owid/base_boot4_covid.html" %}
{% block content %}
    {% load static %}
    {% static "owid/" as static_base %}
    {% load humanize %}

    <script>
    window.countries = [];
    {% for country in data %}
        window.countries.push('{{ country.10 }}')
    {% endfor %}
    </script>
    <script>
        $(document).ready(function () {
            $('#loader3').hide(0);
            {#$('#check').show();#}

            console.log({{ day }})
            if ('{{ day }}' === '0') {
                $('#day1a')
                    .removeClass('text-white')
                    .addClass('text-secondary');
                $('#day2a')
                    .removeClass('text-white')
                    .addClass('text-secondary');
                $('#day0a')
                    .removeClass('text-secondary')
                    .addClass('text-white')
                    .fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
            }
            if ('{{ day }}' === '1') {
                $('#day0a')
                    .removeClass('text-white')
                    .addClass('text-secondary');
                $('#day2a')
                    .removeClass('text-white')
                    .addClass('text-secondary');
                $('#day1a')
                    .removeClass('text-secondary')
                    .addClass('text-white')
                    .fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
            }
            if ('{{ day }}' === '2') {
                $('#day1a')
                    .removeClass('text-white')
                    .addClass('text-secondary');
                $('#day0a')
                    .removeClass('text-white')
                    .addClass('text-secondary');
                $('#day2a')
                    .removeClass('text-secondary')
                    .addClass('text-white')
                    .fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
            }
        });
    </script>

    <div class="container-flex container-wrapper3 scroll-hidden">
        <div class="sticky-top pt-4"
             style="background-image: url('{{ static_base }}{{ background_pattern3 }}');">
            <div class="row ml-2 mb-3">
                <div class="col-lg-2">
                    <div class="ml-4 mt-1 mb-4">
                        <a href="{% url 'owid:covid' %}" role="button" class="btn btn-outline-light btn-sm">
                            <span class="fas fa-chevron-left"></span>
                            &nbsp; covid-19 home
                        </a>
                    </div>
                </div>

                <div class="col-lg-4">
                    <input class="form-control mt-2" id="search_country" type="text" placeholder="Search.."
                           style="background: transparent; color: lightgray;">
                </div>
                {#                <div class="col-lg-1">#}
                {#                    <div>#}
                {#                            <span id="check" class="fas fa-check text-white  float-right mt-3  ml-2 fa-sm"#}
                {#                                  style="opacity: 80%; display: none;"></span>#}
                {#                    </div>#}
                {#                </div>#}
                <div class="col-lg-6">
                    <div class="row mt-1 mb-1">
                        <div class="d-flex justify-content-end" style="width:95%;">
                            <div class="">
                                <form action="{% url 'owid:numbers' %}" method="post" id="day2">
                                    {% csrf_token %}
                                    <input type="hidden" class="form-control" name="day" value="2">
                                    <h5 class="px-4 font-weight-light">
                                        <p class="text-secondary" id="day2a"
                                           style="cursor: pointer; cursor: hand;"
                                           onclick="$('#loader3').show().delay(20000).hide(0); $('#check').hide(0);">
                                            {{ date2 }}
                                        </p>
                                    </h5>
                                </form>
                            </div>
                            <script>
                                $(document).ready(function () {
                                    $("#day2a").click(function () {
                                        $("#day2").submit();
                                    });
                                });
                            </script>
                            <div class="">
                                <form action="{% url 'owid:numbers' %}" method="post" id="day1">
                                    {% csrf_token %}
                                    <input type="hidden" class="form-control" name="day" value="1">
                                    <h5 class="px-4 font-weight-light">
                                        <p class="text-secondary"
                                           id="day1a"
                                           style="cursor: pointer; cursor: hand;"
                                           onclick="$('#loader3').show().delay(20000).hide(0); $('#check').hide(0);">
                                            {{ date1 }}
                                        </p>
                                    </h5>
                                </form>
                            </div>
                            <script>
                                $(document).ready(function () {
                                    $("#day1a").click(function () {
                                        $("#day1").submit();
                                    });
                                });
                            </script>
                            <div class="">
                                <form action="{% url 'owid:numbers' %}" method="post" id="day0">
                                    {% csrf_token %}
                                    <input type="hidden" class="form-control" name="day" value="0">
                                    <h5 class="px-4 font-weight-light">
                                        <p class="text-secondary" id="day0a"
                                           style="cursor: pointer; cursor: hand;"
                                           onclick="$('#loader3').show().delay(20000).hide(0); $('#check').hide(0);">
                                            {{ date0 }}
                                        </p>
                                    </h5>
                                </form>
                            </div>
                            <script>
                                $(document).ready(function () {
                                    $("#day0a").click(function () {
                                        $("#day0").submit();
                                    });
                                });
                            </script>
                        </div>
                    </div>
                    <div class="d-flex justify-content-end mr-5">
                        <p id="loader3" class="loader3" style="width: 90%;"></p>
                    </div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function () {
                var flag = false;
                var value = 'eu';
                $("#search_country").val(value);
                $("#covid_countries tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });

                $("#search_country").on("keyup", function () {
                    var value = $(this).val().toLowerCase();
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    if (flag) {
                        $('#worldh6, #europeh6, #asiah6, #africah6, #north_americah6, #south_americah6, #oceaniah6')
                            .delay(50)
                            .removeClass('text-white').addClass('text-secondary')
                            .fadeOut("fast").fadeIn("slow");
                        flag = false;
                    }
                });

                $("#world")
                    .on("click", function () {
                        flag = true;
                        var value = '';
                        $("#search_country").val(value);
                        $("#covid_countries tr").filter(function () {
                            $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                        });
                        $('#europeh6, #asiah6, #africah6, #north_americah6, #south_americah6, #oceaniah6')
                            .removeClass('text-white').addClass('text-secondary')
                        $('#worldh6')
                            .removeClass('text-secondary')
                            .addClass('text-white')
                            .delay(30).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                    });
                $("#europe").on("click", function () {
                    flag = true;
                    var value = 'europe';
                    $("#search_country").val(value);
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    $('#worldh6, #asiah6, #africah6, #north_americah6, #south_americah6, #oceaniah6')
                        .removeClass('text-white').addClass('text-secondary')
                    $('#europeh6')
                        .removeClass('text-secondary')
                        .addClass('text-white')
                        .delay(30).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                });
                $("#africa").on("click", function () {
                    flag = true;
                    var value = 'africa';
                    $("#search_country").val(value);
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    $('#worldh6, #europeh6, #asiah6, #north_americah6, #south_americah6, #oceaniah6')
                        .removeClass('text-white').addClass('text-secondary')
                    $('#africah6')
                        .removeClass('text-secondary')
                        .addClass('text-white')
                        .delay(50).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                });
                $("#asia").on("click", function () {
                    flag = true;
                    var value = 'asia';
                    $("#search_country").val(value);
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    $('#worldh6, #europeh6, #africah6, #north_americah6, #south_americah6, #oceaniah6')
                        .removeClass('text-white').addClass('text-secondary')
                    $('#asiah6')
                        .removeClass('text-secondary')
                        .addClass('text-white')
                        .delay(50).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                });
                $("#north_america").on("click", function () {
                    flag = true;
                    var value = 'north america';
                    $("#search_country").val(value);
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    $('#worldh6, #europeh6, #asiah6, #africah6, #south_americah6, #oceaniah6')
                        .removeClass('text-white').addClass('text-secondary')
                    $('#north_americah6')
                        .removeClass('text-secondary')
                        .addClass('text-white')
                        .delay(50).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                });
                $("#south_america").on("click", function () {
                    flag = true;
                    var value = 'south america';
                    $("#search_country").val(value);
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    $('#worldh6, #europeh6, #asiah6, #africah6, #north_americah6, #oceaniah6')
                        .removeClass('text-white').addClass('text-secondary')
                    $('#south_americah6')
                        .removeClass('text-secondary')
                        .addClass('text-white')
                        .delay(50).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                });
                $("#oceania").on("click", function () {
                    flag = true;
                    var value = 'oceania';
                    $("#search_country").val(value);
                    $("#covid_countries tr").filter(function () {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                    $('#worldh6, #europeh6, #asiah6, #africah6, #north_americah6, #south_americah6')
                        .removeClass('text-white').addClass('text-secondary')
                    $('#oceaniah6')
                        .removeClass('text-secondary')
                        .addClass('text-white')
                        .delay(50).fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast").fadeOut("fast").fadeIn("fast");
                });
            });
        </script>

        <div class="row mb-2">
            <div class="col-lg-3">
            </div>
            <div class="col-lg-7">
                <ul class="nav  nav-pills">
                    <li class="w-16">
                        <a class="nav-link p-0 m-0" href="#" id="world">
                            <h6 id="worldh6" class=" text-secondary font-weight-light">{{ the_world }}</h6>
                        </a>
                    </li>
                    <li class="w-12">
                        <a class="nav-link p-0 m-0" href="#" id="europe">
                            <h6 id="europeh6" class=" text-secondary font-weight-light">{{ europe }}</h6>
                        </a>
                    </li>
                    <li class="w-10">
                        <a class="nav-link p-0 m-0" href="#" id="asia">
                            <h6 id="asiah6" class=" text-secondary font-weight-light">{{ asia }}</h6>
                        </a>
                    </li>
                    <li class="w-10">
                        <a class="nav-link p-0 m-0" href="#" id="africa">
                            <h6 id="africah6" class=" text-secondary font-weight-light">{{ africa }}</h6>
                        </a>
                    </li>
                    <li class="w-16">
                        <a class="nav-link p-0 m-0" href="#" id="north_america">
                            <h6 id="north_americah6"
                                class=" text-secondary font-weight-light">{{ north_america }}</h6>
                        </a>
                    </li>
                    <li class="w-16">
                        <a class="nav-link p-0 m-0" href="#" id="south_america">
                            <h6 id="south_americah6"
                                class=" text-secondary font-weight-light">{{ south_america }}</h6>
                        </a>
                    </li>
                    <li class="w-10">
                        <a class="nav-link p-0 m-0" href="#" id="oceania">
                            <h6 id="oceaniah6" class=" text-secondary font-weight-light">{{ oceania }}</h6>
                        </a>
                    </li>
                </ul>
            </div>
            <div class="col-lg-2">
            </div>
        </div>

        <div id="tablehead" class="row ml-5 pl-3 mr-5 pr-4">
            <div class="col-lg-12" style="background-color:transparent; color: aqua; height: 60px !important;">
                <div class="table-responsive-sm table-dark table-hover table-borderless"
                     style="background: transparent;  color: aqua">
                    <table class="table" style="background: transparent;  color: white;">
                        <thead class="p-0">
                        <tr class="p-0">
                            <td class="w-11 align-middle p-0"><h5 class="font-weight-light">{{ continent }}</h5>
                            </td>
                            <td class="w-12 align-middle p-0">
                                <h5
                                        class="font-weight-light text-start ml-2">{{ country_name }}
                                    <div id="loading2"
                                         class="spinner-grow spinner-grow-sm text-light ml-5"
                                         style="display:none;">

                                    </div>
                                </h5>
                            </td>
                            <td class="w-10 align-middle p-0"><h6
                                    class="font-weight-light ml-2">{{ population }}</h6>
                            </td>
                            <td class="w-10 align-middle p-0 ml-2"><h6
                                    class="font-weight-light">{{ new_cases }}</h6>
                            </td>
                            <td class="w-10 align-middle p-0 ml-2"><h6
                                    class="font-weight-light">{{ total_cases }}</h6>
                            </td>
                            <td class="w-8 align-middle p-0">
                                <h6 class="font-weight-light">new</h6>
                                <h6 class="font-weight-light">deaths</h6>
                            </td>
                            <td class="w-8 align-middle p-0">
                                <h6 class="font-weight-light">total</h6>
                                <h6 class="font-weight-light">deaths</h6>
                            </td>
                            <td class="w-8 align-middle p-0">
                                <h6 class="font-weight-light p-0">{{ new_cases }}</h6>
                                <p class="small p-0">{{ per_1_million }}</p>
                            </td>
                            <td class="w-8 align-middle p-0">
                                <h6 class="font-weight-light p-0">{{ new_deaths }}</h6>
                                <p class="small p-0">{{ per_1_million }}</p>
                            </td>
                            <td class="w-22 align-middle p-0">
                                <span class="small p-0 ml-3">load previous days</span>
                                <p class="small p-0 ml-3">
                                    <span id="days0a" class="text-white">{{ date0a }}&nbsp;&nbsp;</span>
                                    <span id="days1a" class="text-secondary">{{ date1a }}&nbsp;&nbsp;</span>
                                    <span id="days2a" class="text-secondary">{{ date2a }}</span>
                                </p>
                            </td>
                        </tr>
                        </thead>
                    </table>
                </div>
            </div>
        </div>
        <hr>
    </div>

    <script>
        $(function () {
            $("#covid_table").tablesorter({sortList: [[0, 0], [3, 1],]});
        });
    </script>

    <div class="row ml-5 pl-3 mr-5 pr-4">
        <div class="col-lg-12" style="background-color:transparent; color: aqua;">
            <div class="table-responsive-sm table-dark table-hover table-country"
                 style="background: transparent;  color: aqua">
                <table id="covid_table" class="table tablesorter" style="background: transparent;  color: white;">
                    <thead>
                    <tr>
                        <th class="w-11 align-middle p-0 pl-4">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span></th>
                        <th class="w-12 align-middle p-0 pl-4">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span></th>
                        <td class="w-10 align-middle p-0 pl-5">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-10 align-middle p-0 pl-4">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-10 align-middle p-0 pl-4">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-8 align-middle p-0 pl-2">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-8 align-middle p-0 pl-3">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-8 align-middle p-0 pl-4">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-8 align-middle p-0 pl-2">
                            <span class="fas fa-sort-up text-muted"></span>
                            <span class="fas fa-sort-down text-muted"></span>
                        </th>
                        <td class="w-22 align-middle p-0 pl-4">

                        </th>
                    </tr>
                    </thead>
                    <tbody id="covid_countries">
                    {% for country in data %}
                        <tr id="{{ country }}_row" class="font-weight-light">
                            <td style="opacity:70%;">{{ country.0 }}</td>
                            <td id="{{ country.10 }}" style="cursor: pointer; cursor: hand;">
                                <form method='GET'>
                                    <input type="hidden" class="form-control" name="country"
                                           value="{{ country.1 }}">
                                    <span class="font-weight-light" style="font-size: 18px;"> {{ country.1 }}</span>

                                </form>
                                <script>
                                    $('#{{ country.10 }}').on('click', function (e) {
                                        $('#loading2').show();
                                        e.preventDefault();
                                        var country = '{{ country.1 }}'
                                        console.log(country);

                                        $.get('{%  url 'owid:country_json'  %}',
                                            {'country': country},
                                            function (response) {
                                                $('#table_country_detail tbody > tr').remove();
                                                var data = response.country;
                                                var len = data.length;
                                                for (var i = len - 1; i >= 0; i--) {
                                                    var new_cases, total_cases, new_deaths,
                                                        total_deaths, new_tests, total_tests;
                                                    var name = data[i].name;
                                                    var date = data[i].date;
                                                    if (data[i].new_cases > -1) {
                                                        new_cases = Number(parseFloat(data[i].new_cases)
                                                            .toFixed(0))
                                                            .toLocaleString('en', {minimumFractionDigits: 0});
                                                    } else {
                                                        new_cases = 'no data';
                                                    }
                                                    if (data[i].total_cases > -1) {
                                                        total_cases = Number(parseFloat(data[i].total_cases)
                                                            .toFixed(0))
                                                            .toLocaleString('en', {minimumFractionDigits: 0});
                                                    } else {
                                                        total_cases = 'no data';
                                                    }
                                                    if (data[i].new_deaths > -1) {
                                                        new_deaths = Number(parseFloat(data[i].new_deaths)
                                                            .toFixed(0))
                                                            .toLocaleString('en', {minimumFractionDigits: 0});
                                                    } else {
                                                        new_deaths = 'no data';
                                                    }
                                                    if (data[i].total_deaths > -1) {
                                                        total_deaths = Number(parseFloat(data[i].total_deaths)
                                                            .toFixed(0))
                                                            .toLocaleString('en', {minimumFractionDigits: 0});
                                                    } else {
                                                        total_deaths = 'no data';
                                                    }
                                                    if (data[i].new_tests > -1) {
                                                        new_tests = Number(parseFloat(data[i].new_tests)
                                                            .toFixed(0))
                                                            .toLocaleString('en', {minimumFractionDigits: 0});
                                                    } else {
                                                        new_tests = 'no data';
                                                    }
                                                    if (data[i].total_tests > -1) {
                                                        total_tests = Number(parseFloat(data[i].total_tests)
                                                            .toFixed(0))
                                                            .toLocaleString('en', {minimumFractionDigits: 0});
                                                    } else {
                                                        total_tests = 'no data';
                                                    }

                                                    <!-- console.log(date + ', ' + new_cases)-->

                                                    $('#table_country_detail').find('tbody').append(
                                                        '<tr><td class="w-25 text-right pr-5 mr-5 text-white" style="opacity: 80%">' + date +
                                                        '</td><td class="w-11 text-center" style="color: #e9e9af;">' + new_cases + '' +
                                                        '</td><td class="w-11 text-center" style="color: #e9e9af;">' + total_cases +
                                                        '</td><td class="w-11 text-center" style="color: #ff6666;">' + new_deaths +
                                                        '</td><td class="w-11 text-center" style="color: #ff6666;">' + total_deaths +
                                                        '</td><td class="w-11 text-center" style="color: white; opacity: 80%;">' + new_tests +
                                                        '</td><td class="w-11 text-center" style="color: white; opacity: 80%;">' + total_tests +
                                                        '</td></tr>')
                                                    $('#modal_header').text("{{ country.1 }}")
                                                    $('#modal_header1').text('number of records: ' + len)
                                                    $('#modal_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}")
                                                }
                                                $("#btn_modal").trigger("click");
                                                $('#loading2').hide(0);

                                            });
                                    });
                                </script>
                            </td>
                            <td class="text-info"
                                style="font-family: 'Lucida Console';font-size: 18px;">{{ country.1.population|floatformat:"0"|intcomma }}</td>
                            <td class="" id="{{ country.10 }}_newcases"
                                style="font-family: 'Lucida Console';color: #e9e9af;font-size: 18px;cursor: pointer; cursor: hand;">
                                {{ country.2|floatformat:"0"|intcomma }}
                            </td>
                            <td class="" id="{{ country.10 }}_totalcases"
                                style="font-family: 'Lucida Console';color: #e9e9af;font-size: 18px;cursor: pointer; cursor: hand;">
                                {{ country.3|floatformat:"0"|intcomma }}
                            </td>
                            <td class="" id="{{ country.10 }}_newdeaths"
                                style="font-family: 'Lucida Console';color: #ff6666;font-size: 18px;cursor: pointer; cursor: hand;">
                                {{ country.4|floatformat:"0"|intcomma }}
                            </td>
                            <td class="" id="{{ country.10 }}_totaldeaths"
                                style="font-family: 'Lucida Console';color: #ff6666;font-size: 18px;cursor: pointer; cursor: hand;">
                                {{ country.5|floatformat:"0"|intcomma }}
                            </td>
                            <td class="" id="{{ country.10 }}_newcasesper1m"
                                style="font-family: 'Lucida Console';color: #e9e9af;font-size: 18px;cursor: pointer; cursor: hand;">
                                {{ country.6|floatformat:"1"|intcomma }}
                            </td>
                            <td class="" id="{{ country.10 }}_newdeathsper1m"
                                style="font-family: 'Lucida Console';color: #ff6666;font-size: 18px;cursor: pointer; cursor: hand;">
                                {{ country.8|floatformat:"1"|intcomma }}
                            </td>
                            <td id="{{ country.10 }}_radiocell">
                                <form id="{{ country.10 }}days_choice">
                                    <div class="custom-control custom-radio custom-control-inline">
                                        <input class="custom-control-input" type="radio" id="{{ country.10 }}radio0"
                                               name="day" value="0" checked="checked">
                                        <label class="custom-control-label mr-1" for="{{ country.10 }}radio0">
                                            <pre> </pre>
                                        </label>
                                    </div>
                                    <div class="custom-control custom-radio custom-control-inline">
                                        <input class="custom-control-input" type="radio" id="{{ country.10 }}radio1"
                                               name="day" value="1">
                                        <label class="custom-control-label ml-1 mr-1" for="{{ country.10 }}radio1">
                                            <pre> </pre>
                                        </label>
                                    </div>
                                    <div class="custom-control custom-radio custom-control-inline">
                                        <input class="custom-control-input" type="radio" id="{{ country.10 }}radio2"
                                               name="day" value="2">
                                        <label class="custom-control-label ml-1" for="{{ country.10 }}radio2">
                                            <pre> </pre>
                                        </label>
                                        </label>
                                    </div>
                                </form>
                            </td>
                            <script>
                                $(document).ready(function () {
                                    $('#{{ country.10 }}days_choice input').change(function (e) {
                                        e.preventDefault();
                                        days = $('input[name=day]:checked', '#{{ country.10 }}days_choice').val();
                                        var country = '{{ country.1 }}'

                                        $.get('{%  url 'owid:numbers_json'  %}',
                                            {'country': country, 'days': days},
                                            function (response) {

                                                var data = response.country;
                                                var len = data.length;
                                                console.log(len)
                                                var new_cases, total_cases, new_deaths,
                                                    total_deaths, new_cases_per_million, new_deaths_per_million;
                                                if (data[0].new_cases > -1) {
                                                    new_cases = Number(parseFloat(data[0].new_cases)
                                                        .toFixed(0))
                                                        .toLocaleString('en', {minimumFractionDigits: 0});
                                                } else {
                                                    new_cases = 'no data';
                                                }
                                                if (data[0].total_cases > -1) {
                                                    total_cases = Number(parseFloat(data[0].total_cases)
                                                        .toFixed(0))
                                                        .toLocaleString('en', {minimumFractionDigits: 0});
                                                } else {
                                                    total_cases = 'no data';
                                                }
                                                if (data[0].new_deaths > -1) {
                                                    new_deaths = Number(parseFloat(data[0].new_deaths)
                                                        .toFixed(0))
                                                        .toLocaleString('en', {minimumFractionDigits: 0});
                                                } else {
                                                    new_deaths = 'no data';
                                                }
                                                if (data[0].total_deaths > -1) {
                                                    total_deaths = Number(parseFloat(data[0].total_deaths)
                                                        .toFixed(0))
                                                        .toLocaleString('en', {minimumFractionDigits: 0});
                                                } else {
                                                    total_deaths = 'no data';
                                                }
                                                if (data[0].new_cases_per_million > -1) {
                                                    new_cases_per_million = Number(parseFloat(data[0].new_cases_per_million)
                                                        .toFixed(1))
                                                        .toLocaleString('en', {minimumFractionDigits: 1});
                                                } else {
                                                    new_cases_per_million = 'no data';
                                                }
                                                if (data[0].new_deaths_per_million > -1) {
                                                    new_deaths_per_million = Number(parseFloat(data[0].new_deaths_per_million)
                                                        .toFixed(1))
                                                        .toLocaleString('en', {minimumFractionDigits: 1});
                                                } else {
                                                    new_deaths_per_million = 'no data';
                                                }

                                                $("#{{ country.10 }}_newcases").text(new_cases);
                                                $("#{{ country.10 }}_totalcases").text(total_cases);
                                                $("#{{ country.10 }}_newdeaths").text(new_deaths);
                                                $("#{{ country.10 }}_totaldeaths").text(total_deaths);
                                                $("#{{ country.10 }}_newcasesper1m").text(new_cases_per_million);
                                                $("#{{ country.10 }}_newdeathsper1m").text(new_deaths_per_million);

                                                if (days === '0') {
                                                    $('#days0a')
                                                        .removeClass('text-secondary')
                                                        .addClass('text-white');
                                                    $('#days1a')
                                                        .removeClass('text-white')
                                                        .addClass('text-secondary');
                                                    $('#days2a')
                                                        .removeClass('text-white')
                                                        .addClass('text-secondary');
                                                }
                                                if (days === '1') {
                                                    $('#days1a')
                                                        .removeClass('text-secondary')
                                                        .addClass('text-white');
                                                    $('#days0a')
                                                        .removeClass('text-white')
                                                        .addClass('text-secondary');
                                                    $('#days2a')
                                                        .removeClass('text-white')
                                                        .addClass('text-secondary');
                                                }
                                                if (days === '2') {
                                                    $('#days2a')
                                                        .removeClass('text-secondary')
                                                        .addClass('text-white');
                                                    $('#days1a')
                                                        .removeClass('text-white')
                                                        .addClass('text-secondary');
                                                    $('#days0a')
                                                        .removeClass('text-white')
                                                        .addClass('text-secondary');
                                                }

                                                {#console.log(window.countries);#}
                                                for (i = 0; i < window.countries.length; i++) {
                                                    $('#' + window.countries[i] + '_radiocell').removeClass('radiocell_selected');
                                                }
                                                $('#{{ country.10 }}_radiocell').addClass('radiocell_selected');

                                            });
                                    });
                                });
                            </script>

                            <script>
                                $('#{{ country.10 }}_newcases').on('click', function (e) {
                                    $('#loading2').show();
                                    e.preventDefault();
                                    var day = '0'
                                    var type = 'new_cases'
                                    var country = '{{ country.1 }}'

                                    $.get('{%  url 'owid:country_json_chart'  %}',
                                        {'type': type, 'country': country},
                                        function (response) {
                                            var labels_json = response.country[0];
                                            var values_json = response.country[1];
                                            {##}
                                            {#console.log(window.labels_json);#}
                                            {#console.log(window.values_json);#}

                                            $('#country_modal_chartbar_header').text("{{ country.1 }}");
                                            $('#country_modal_chartbar_header1').text('new cases');
                                            $('#country_modal_chartbar_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}");
                                            $("#btn_modal_chartbar").trigger("click");
                                            $('#loading2').hide(0);

                                            var backColor = "rgba(255, 255, 130, 0.7)";
                                            var bordColor = "rgba(255, 255, 130, 0.7)";
                                            $.chartbar(labels_json, values_json, backColor, bordColor);
                                        });
                                });
                            </script>

                            <script>
                                $('#{{ country.10 }}_totalcases').on('click', function (e) {
                                    $('#loading2').show();
                                    e.preventDefault();
                                    var day = '0'
                                    var type = 'total_cases'
                                    var country = '{{ country.1 }}'

                                    $.get('{%  url 'owid:country_json_chart'  %}',
                                        {'type': type, 'country': country},
                                        function (response) {
                                            var labels_json = response.country[0];
                                            var values_json = response.country[1];
                                            {##}
                                            {#console.log(window.labels_json);#}
                                            {#console.log(window.values_json);#}

                                            $('#country_modal_chartbar_header').text("{{ country.1 }}");
                                            $('#country_modal_chartbar_header1').text('total cases');
                                            $('#country_modal_chartbar_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}");
                                            $("#btn_modal_chartbar").trigger("click");
                                            $('#loading2').hide(0);

                                            var backColor = "rgba(255, 255, 130, 0.7)";
                                            var bordColor = "rgba(255, 255, 130, 0.7)";
                                            $.chartbar(labels_json, values_json, backColor, bordColor);
                                        });
                                });
                            </script>

                            <script>
                                $('#{{ country.10 }}_newdeaths').on('click', function (e) {
                                    $('#loading2').show();
                                    e.preventDefault();
                                    var day = '0'
                                    var type = 'new_deaths'
                                    var country = '{{ country.1 }}'

                                    $.get('{%  url 'owid:country_json_chart'  %}',
                                        {'type': type, 'country': country},
                                        function (response) {
                                            var labels_json = response.country[0];
                                            var values_json = response.country[1];
                                            {##}
                                            {#console.log(window.labels_json);#}
                                            {#console.log(window.values_json);#}

                                            $('#country_modal_chartbar_header').text("{{ country.1 }}");
                                            $('#country_modal_chartbar_header1').text('new deaths');
                                            $('#country_modal_chartbar_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}");
                                            $("#btn_modal_chartbar").trigger("click");
                                            $('#loading2').hide(0);

                                            var backColor = "rgba(255, 51, 51, 0.7)";
                                            var bordColor = "rgba(255, 51, 51, 0.7)";
                                            $.chartbar(labels_json, values_json, backColor, bordColor);
                                        });
                                });
                            </script>

                            <script>
                                $('#{{ country.10 }}_totaldeaths').on('click', function (e) {
                                    $('#loading2').show();
                                    e.preventDefault();
                                    var day = '0'
                                    var type = 'total_deaths'
                                    var country = '{{ country.1 }}'

                                    $.get('{%  url 'owid:country_json_chart'  %}',
                                        {'type': type, 'country': country},
                                        function (response) {
                                            var labels_json = response.country[0];
                                            var values_json = response.country[1];
                                            {##}
                                            {#console.log(window.labels_json);#}
                                            {#console.log(window.values_json);#}

                                            $('#country_modal_chartbar_header').text("{{ country.1 }}");
                                            $('#country_modal_chartbar_header1').text('total deaths');
                                            $('#country_modal_chartbar_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}");
                                            $("#btn_modal_chartbar").trigger("click");
                                            $('#loading2').hide(0);

                                            var backColor = "rgba(255, 51, 51, 0.7)";
                                            var bordColor = "rgba(255, 51, 51, 0.7)";
                                            $.chartbar(labels_json, values_json, backColor, bordColor);
                                        });
                                });
                            </script>

                            <script>
                                $('#{{ country.10 }}_newcasesper1m').on('click', function (e) {
                                    $('#loading2').show();
                                    e.preventDefault();
                                    var day = '0'
                                    var type = 'newcasesper1m'
                                    var country = '{{ country.1 }}'

                                    $.get('{%  url 'owid:country_json_chart'  %}',
                                        {'type': type, 'country': country},
                                        function (response) {
                                            var labels_json = response.country[0];
                                            var values_json = response.country[1];
                                            {##}
                                            {#console.log(window.labels_json);#}
                                            {#console.log(window.values_json);#}

                                            $('#country_modal_chartbar_header').text("{{ country.1 }}");
                                            $('#country_modal_chartbar_header1').text('new cases per million');
                                            $('#country_modal_chartbar_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}");
                                            $("#btn_modal_chartbar").trigger("click");
                                            $('#loading2').hide(0);

                                            var backColor = "rgba(255, 255, 130, 0.7)";
                                            var bordColor = "rgba(255, 255, 130, 0.7)";
                                            $.chartbar(labels_json, values_json, backColor, bordColor);
                                        });
                                });
                            </script>

                            <script>
                                $('#{{ country.10 }}_newdeathsper1m').on('click', function (e) {
                                    $('#loading2').show();
                                    e.preventDefault();
                                    var day = '0'
                                    var type = 'newdeathsper1m'
                                    var country = '{{ country.1 }}'

                                    $.get('{%  url 'owid:country_json_chart'  %}',
                                        {'type': type, 'country': country},
                                        function (response) {
                                            var labels_json = response.country[0];
                                            var values_json = response.country[1];
                                            {##}
                                            {#console.log(window.labels_json);#}
                                            {#console.log(window.values_json);#}

                                            $('#country_modal_chartbar_header').text("{{ country.1 }}");
                                            $('#country_modal_chartbar_header1').text('new deaths per million');
                                            $('#country_modal_chartbar_header2').text("{{ country.1.population|floatformat:"0"|intcomma }}");
                                            $("#btn_modal_chartbar").trigger("click");
                                            $('#loading2').hide(0);

                                            var backColor = "rgba(255, 51, 51, 0.7)";
                                            var bordColor = "rgba(255, 51, 51, 0.7)";
                                            $.chartbar(labels_json, values_json, backColor, bordColor);
                                        });
                                });
                            </script>


                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    </div>

    <div class="row py-5">
        <div class="col">

        </div>

    </div>

    <button id="btn_modal" type="button" class="btn btn-outline-light"
            data-toggle="modal" data-target="#country_modal"
            style="display:none;">
        Open modal
    </button>



    <!-- The Modal table -->
    <div class="modal" id="country_modal">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header" style="background-color: #0d0d0d;">
                    <div class="table-responsive-lg" style="width:100% !important;">
                        <table class="table-borderless" style="width:100% !important;">
                            <tr>
                                <td class="w-30 px-3 mr-auto">
                                    <h4 id="modal_header" class="modal-title text-white font-weight-light"></h4>
                                </td>
                                <td class="w-30">
                                    <span id="modal_header1"
                                          class="modal-title text-secondary font-weight-light"></span>
                                </td>

                                <td class="w-15 px-2 mt-2">
                                    <h5 class="modal-title text-info font-weight-light text-right">population: </h5>
                                </td>
                                <td class="w-15 px-1 mt-2">
                                    <h4 id="modal_header2" class="modal-title text-info font-weight-light text-right"
                                        style="font-family: 'Lucida Console';"></h4>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div class="px-3 mt-1">
                        <button type="button" class="close text-light" data-dismiss="modal">&times;</button>
                    </div>
                </div>
                <!-- Modal body -->
                <div class="modal-body" style="background-color: #0d0d0d;">
                    <div class="col text-white">
                        <table id="table_country_detail" class="table table-dark table-hover"
                               style="background-color: #0d0d0d;">
                            <thead style="border: 0px !important;">
                            <tr style="border: 0px !important;">
                                <td class="w-25 text-center p-0 py-3 pl-4"
                                    style="vertical-align: center !important;border: 0px !important;">
                                    date
                                </td>
                                <td class="w-11 align-middle p-0 py-3 pl-4 ml-3" style="border: 0px !important;">
                                    new cases
                                </td>
                                <td class="w-11 align-middle p-0 py-3 pl-4 ml-3" style="border: 0px !important;">
                                    total cases
                                </td>
                                <td class="w-11 align-middle p-0 py-3 pl-4 ml-3" style="border: 0px !important;">
                                    new deaths
                                </td>
                                <td class="w-11 align-middle p-0 py-3 pl-4 ml-3" style="border: 0px !important;">
                                    total deaths
                                </td>
                                <td class="w-11 align-middle p-0 py-3 pl-4 ml-3" style="border: 0px !important;">
                                    new tests
                                </td>
                                <td class="w-11 align-middle p-0 py-3 pl-4 ml-3" style="border: 0px !important;">
                                    total tests
                                </td>
                            </tr>
                            </thead>

                            <tbody>

                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        $('#country_modal_chartbar').on('hide.bs.modal', function () {
            {#chart_bar.destroy();#}
            console.log('destroyed')
        })
    </script>

    <button id="btn_modal_chartbar" type="button" class="btn btn-outline-light"
            data-toggle="modal" data-target="#country_modal_chartbar"
            style="display:none;">
        Open chart modal
    </button>

    <!-- The Modal chart -->
    <div class="modal" id="country_modal_chartbar">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <!-- Modal Header -->
                <div class="modal-header" style="background-color: #0d0d0d;">
                    <div class="table-responsive-lg" style="width:100% !important;">
                        <table class="table-borderless" style="width:100% !important;">
                            <tr>
                                <td class="w-30 px-3 mr-auto">
                                    <h4 id="country_modal_chartbar_header"
                                        class="modal-title text-white font-weight-light"></h4>
                                </td>
                                <td class="w-30">
                                    <span id="country_modal_chartbar_header1"
                                          class="modal-title text-white font-weight-light"></span>
                                </td>

                                <td class="w-15 px-2 mt-2">
                                    <h5 class="modal-title text-info font-weight-light text-right">population: </h5>
                                </td>
                                <td class="w-15 px-1 mt-2">
                                    <h4 id="country_modal_chartbar_header2"
                                        class="modal-title text-info font-weight-light text-right"
                                        style="font-family: 'Lucida Console';"></h4>
                                </td>
                            </tr>
                        </table>
                    </div>

                    <div class="px-3 mt-1">
                        <button type="button" class="close text-light" data-dismiss="modal">&times;</button>
                    </div>
                </div>
                <!-- Modal body -->
                <div class="modal-body" style="background-color: #0d0d0d;">
                    <div class="">

                        <div style="text-align: center;">
                            <canvas id="chart" width="800" height="400"></canvas>
                            <script>
                                $.chartbar = function (labels_json, values_json, backcolor, bordcolor) {

                                    if (window.chart_bar != null) {
                                        window.chart_bar.destroy();
                                        console.log('chart destroyed')
                                    }

                                    var ctx = document.getElementById('chart').getContext('2d');
                                    window.chart_bar = new Chart(ctx, {
                                        type: 'bar',
                                        data: {
                                            labels: labels_json,
                                            datasets: [{
                                                label: "",
                                                data: values_json,
                                                backgroundColor: backcolor,
                                                borderColor: bordcolor,
                                                borderWidth: 1,
                                                barPercentage: 0.9,
                                                barThickness: 'flex',
                                            }]
                                        },
                                        options: {
                                            scales: {
                                                xAxes: [{
                                                    gridLines: {
                                                        color: "rgba(255, 255, 255, 0.15)",
                                                        zeroLineColor: "rgba(255, 255, 255, 0.5)",
                                                    },
                                                    ticks: {
                                                        fontColor: "rgba(255, 255, 255, 0.8)",
                                                    }
                                                }],
                                                yAxes: [{
                                                    gridLines: {
                                                        color: "rgba(255, 255, 255, 0.15)",
                                                        zeroLineColor: "rgba(255, 255, 255, 0.5)",
                                                    },
                                                    ticks: {
                                                        beginAtZero: true,
                                                        fontColor: "rgba(255, 255, 255, 0.8)",
                                                        userCallback: function (value, index, values) {
                                                            return value.toLocaleString();
                                                        }
                                                    },
                                                }]

                                            },
                                            legend: {
                                                display: false,
                                                labels: {
                                                    fontColor: 'rgb(255, 255, 255)'
                                                }
                                            },
                                            title: {
                                                display: false,
                                                text: ''
                                            },
                                            hover: {
                                                mode: 'index',
                                                intersect: false
                                            },
                                            responsive: true,
                                            tooltips: {
                                                enabled: true,
                                                mode: 'index',
                                                intersect: false,
                                                yAlign: 'left',
                                                callbacks: {
                                                    label: function (tooltipItem, data) {
                                                        var tooltipValue = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                                                        return parseInt(tooltipValue).toLocaleString();
                                                    }
                                                },
                                            },
                                        }
                                    });
                                }
                            </script>

                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>



{% endblock %}

